<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Draft Generator - Foothills Fire Prevention</title>
    <!-- Force no-cache to ensure latest version -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        /* Typography System - Shared from main site */
        :root {
            --font-primary: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-size-base: 16px;
            --font-size-sm: 0.875rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 2rem;
            --font-size-4xl: 2.5rem;
            --line-height-tight: 1.25;
            --line-height-base: 1.6;
            --line-height-relaxed: 1.75;
            --letter-spacing-tight: -0.025em;
            --letter-spacing-wide: 0.025em;
        }
        
        body {
            font-family: var(--font-primary);
            font-size: var(--font-size-base);
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: var(--line-height-base);
            color: #2c3e50;
            background: #f8f9fa;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Header - Simplified version */
        .header {
            background: linear-gradient(135deg, #1a2332 0%, #2c3e50 60%, #c9302c 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0 0 10px 0;
            font-size: var(--font-size-3xl);
            font-weight: 700;
            letter-spacing: var(--letter-spacing-tight);
        }
        .header p {
            margin: 0;
            font-size: var(--font-size-lg);
            opacity: 0.95;
        }

        /* Back link */
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #2c5282;
            text-decoration: none;
            font-size: var(--font-size-sm);
            font-weight: 500;
        }
        .back-link:hover {
            text-decoration: underline;
        }

        /* Form Container */
        .form-container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* Form Styles */
        form {
            margin: 0;
        }
        
        fieldset {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            background: #fafbfc;
        }
        
        legend {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: #1a2332;
            padding: 0 10px;
            margin-bottom: 15px;
        }
        
        /* Input Groups */
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group:last-child {
            margin-bottom: 0;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
            font-size: var(--font-size-base);
        }
        
        input[type="text"],
        input[type="email"],
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: var(--font-size-base);
            font-family: var(--font-primary);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            box-sizing: border-box;
        }
        
        input[type="text"]:focus,
        input[type="email"]:focus,
        textarea:focus {
            outline: none;
            border-color: #2c5282;
            box-shadow: 0 0 0 3px rgba(44, 82, 130, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Radio and Checkbox Styles */
        .radio-group,
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .radio-item,
        .checkbox-item {
            display: flex;
            align-items: center;
        }
        
        input[type="radio"],
        input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .radio-item label,
        .checkbox-item label {
            margin-bottom: 0;
            cursor: pointer;
            font-weight: normal;
        }

        /* Two Column Layout for Checkboxes */
        #residentType {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        /* Concerns layout - single column for better grouped display */
        #concerns {
            display: block;
        }
        
        #concerns .checkbox-item {
            margin-left: 20px;
            margin-bottom: 8px;
        }

        /* Submit Button */
        .submit-button {
            background: #c9302c;
            color: white;
            padding: 16px 40px;
            border: none;
            border-radius: 6px;
            font-size: var(--font-size-lg);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(201, 48, 44, 0.2);
            width: 100%;
        }
        
        .submit-button:hover {
            background: #a02622;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(201, 48, 44, 0.3);
        }
        
        .submit-button:active {
            transform: translateY(0);
        }

        /* Loading State */
        .submit-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        /* Results Section */
        .results-container {
            display: none;
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .results-container h2 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #1a2332;
            font-size: var(--font-size-2xl);
        }
        
        .email-subject {
            font-weight: 600;
            color: #2c5282;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #2c5282;
        }
        
        .email-content {
            white-space: pre-wrap;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            margin-bottom: 20px;
            font-family: var(--font-primary);
            line-height: var(--line-height-relaxed);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .action-button {
            flex: 1;
            min-width: 200px;
            padding: 14px 28px;
            border: none;
            border-radius: 6px;
            font-size: var(--font-size-base);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            text-decoration: none;
            font-family: var(--font-primary);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        /* Primary action - Email button */
        .email-button {
            background: #c9302c;
            color: white;
            box-shadow: 0 2px 4px rgba(201, 48, 44, 0.2);
        }
        
        .email-button:hover {
            background: #a02622;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(201, 48, 44, 0.3);
        }
        
        /* Secondary action - Copy button */
        .copy-button {
            background: white;
            color: #2c5282;
            border: 2px solid #2c5282;
            box-shadow: 0 2px 4px rgba(44, 82, 130, 0.1);
        }
        
        .copy-button:hover {
            background: #2c5282;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(44, 82, 130, 0.2);
        }
        
        /* Small copy buttons for fields */
        .field-copy-button {
            padding: 10px 20px;
            font-size: var(--font-size-sm);
            min-width: 120px;
            background: white;
            color: #2c5282;
            border: 2px solid #2c5282;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            font-family: var(--font-primary);
            text-align: center;
            display: inline-block;
        }
        
        .field-copy-button:hover {
            background: #2c5282;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(44, 82, 130, 0.15);
        }
        
        .field-copy-button:active {
            transform: translateY(0);
        }
        
        .share-button:hover {
            background: #365899 !important;
            transform: translateY(-2px);
        }

        /* Error Message */
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        /* Success Message */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .header {
                padding: 25px 20px;
            }
            
            .header h1 {
                font-size: var(--font-size-2xl);
            }
            
            .form-container,
            .results-container {
                padding: 20px;
            }
            
            fieldset {
                padding: 15px;
            }
            
            #residentType {
                grid-template-columns: 1fr;
            }
            
            #concerns .checkbox-item {
                margin-left: 15px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-button {
                width: 100%;
            }
        }

        /* Small mobile */
        @media (max-width: 480px) {
            .submit-button {
                padding: 14px 20px;
                font-size: var(--font-size-base);
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Main Page</a>
    
    <div class="header">
        <h1>Let Your Voice Be Heard</h1>
        <p>Generate a personalized quick draft to Ada County officials in minutes</p>
    </div>
    
    <!-- What is the Quick Draft Tool? -->
    <div class="intro-container" style="background: white; border-radius: 8px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
        <h2 style="color: #2c3e50; font-size: var(--font-size-2xl); margin: 0 0 20px 0;">What is the Quick Draft Tool?</h2>
        
        <p style="font-size: var(--font-size-lg); line-height: var(--line-height-relaxed); margin-bottom: 15px;">
            Writing to county officials is one of the most effective ways to influence this decision. Personal emails in your own words carry the most weight.
        </p>
        
        <p style="line-height: var(--line-height-relaxed);">
            We know that starting an email can be the hardest part. This tool uses AI to create a personalized draft based on your specific situation and concerns. Think of it as a starting point - not a final product.
        </p>
    </div>

    <!-- How It Works -->
    <div class="intro-container" style="background: white; border-radius: 8px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
        <h2 style="color: #2c3e50; font-size: var(--font-size-2xl); margin: 0 0 20px 0;">How It Works</h2>
        
        <ol style="margin: 0; padding-left: 25px; line-height: var(--line-height-relaxed);">
            <li style="margin-bottom: 10px;">Fill out the form below with your information and concerns</li>
            <li style="margin-bottom: 10px;">Click "Generate Quick Draft" to create a personalized draft</li>
            <li style="margin-bottom: 10px;">Review the draft and edit it to match your voice</li>
            <li>Copy the final version and send it to Ada County officials</li>
        </ol>
    </div>

    <!-- How to Use This Tool Effectively -->
    <div class="intro-container" style="background: white; border-radius: 8px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
        <h2 style="color: #2c3e50; font-size: var(--font-size-2xl); margin: 0 0 20px 0;">How to Use This Tool Effectively</h2>
        
        <div style="background: #f8f9fa; border-left: 4px solid #2c5282; padding: 20px; border-radius: 4px; margin-bottom: 20px;">
            <p style="margin: 0 0 15px 0; font-weight: 600; color: #1a2332;">
                The More You Share, The Better Your Email Will Be
            </p>
            <p style="margin: 0; color: #495057;">
                Generic emails get ignored - personal stories get attention. This tool works best when you provide specific details in your own words.
            </p>
        </div>

        <h3 style="color: #2c3e50; font-size: var(--font-size-lg); margin: 20px 0 15px 0;">Tips for a Powerful Email:</h3>
        
        <div style="margin-bottom: 20px;">
            <div style="margin-bottom: 12px;">
                <strong>✓ Use the text boxes</strong><br>
                <span style="color: #6c757d;">Don't just check boxes. The more you write in "Personal Impact" and other fields, the more authentic your email will be.</span>
            </div>
            
            <div style="margin-bottom: 12px;">
                <strong>✓ Be specific</strong><br>
                <span style="color: #6c757d;">Instead of "I'm concerned about noise," write "I can hear gunfire from my backyard during dinner time"</span>
            </div>
            
            <div style="margin-bottom: 12px;">
                <strong>✓ Share your story</strong><br>
                <span style="color: #6c757d;">Do you hike those trails? Live nearby? Have kids who play outside? Have a dog terrified by gunfire? Include these details!</span>
            </div>
            
            <div style="margin-bottom: 12px;">
                <strong>✓ Use your words</strong><br>
                <span style="color: #6c757d;">Write how you naturally speak. If you'd say "this really pisses me off," put that. If you'd say "I'm deeply troubled," use that.</span>
            </div>
        </div>

        <h3 style="color: #2c3e50; font-size: var(--font-size-lg); margin: 20px 0 15px 0;">Examples of Details That Matter:</h3>
        
        <ul style="margin: 0 0 20px 0; padding-left: 25px; color: #495057; line-height: var(--line-height-relaxed);">
            <li>"Every high wind hot day, I'm on edge because of fire danger"</li>
            <li>"My dog won't go outside when the shooting starts"</li>
            <li>"I moved here specifically for the quiet trails"</li>
            <li>"I'm a gun owner myself but this is too close to homes"</li>
        </ul>
        
        <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 4px;">
            <p style="margin: 0; color: #856404;">
                <strong>Remember:</strong> The checkboxes give structure, but YOUR WORDS make the difference. Officials can spot generic emails immediately. The 2 minutes you spend adding personal details could determine whether your email gets counted or ignored.
            </p>
        </div>
    </div>
    
    <div class="form-container">
        <h2 style="color: #2c3e50; font-size: var(--font-size-2xl); margin: 0 0 25px 0; text-align: center;">Let's write!</h2>
        
        <form id="emailForm">
            <!-- Basic Information -->
            <fieldset>
                <legend>Your Information</legend>
                
                <div class="input-group">
                    <label for="name">Name (required)</label>
                    <input type="text" id="name" name="name" required>
                </div>
                
                <div class="input-group">
                    <label for="city">City (required)</label>
                    <input type="text" id="city" name="city" required>
                </div>
                
                <div class="input-group">
                    <label for="state">State (required)</label>
                    <input type="text" id="state" name="state" required value="ID">
                </div>
                
                <div class="input-group">
                    <label for="zipcode">Zipcode (required)</label>
                    <input type="text" id="zipcode" name="zipcode" required pattern="[0-9]{5}" placeholder="83714">
                </div>
            </fieldset>

            <!-- Resident Type -->
            <fieldset>
                <legend>I am a... (check all that apply)</legend>
                <div id="residentType" class="checkbox-group"></div>
                <div class="input-group" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                    <label for="residentTypeOther" style="font-weight: 600; color: #2c5282; font-size: var(--font-size-base);">Your Specific Situation - In Your Words</label>
                    <textarea id="residentTypeOther" name="residentTypeOther" rows="3"
                              style="margin-top: 8px;"
                              placeholder="Describe your connection to the area: Are you a local teacher, volunteer firefighter, long-time resident? How long have you lived here? What brought you to this community?"></textarea>
                </div>
            </fieldset>

            <!-- Distance from Range -->
            <fieldset>
                <legend>Distance from 15401 N. Cartwright Rd.</legend>
                <div id="distance" class="radio-group"></div>
            </fieldset>

            <!-- Primary Concerns -->
            <fieldset>
                <legend>What are your primary concerns? (check all that apply)</legend>
                <div id="concerns" class="checkbox-group"></div>
                <div class="input-group" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                    <label for="concernsOther" style="font-weight: 600; color: #2c5282; font-size: var(--font-size-base);">Your Specific Concerns - In Your Words</label>
                    <textarea id="concernsOther" name="concernsOther" rows="3"
                              style="margin-top: 8px;"
                              placeholder="What specific concerns do you have? How would this shooting range impact your daily life, your family, your property? Be as detailed as possible - your personal perspective matters."></textarea>
                </div>
            </fieldset>

            <!-- Personal Impact -->
            <fieldset>
                <legend>Personal Impact</legend>
                <label for="personalImpact" style="font-weight: 600; color: #2c5282; font-size: var(--font-size-base);">Your Personal Story - This Is Where You Make It Real</label>
                <p style="margin: 5px 0 10px 0; font-size: var(--font-size-sm); color: #6c757d;">This is the most important field. Share your experiences, fears, and what this means for your life.</p>
                <textarea id="personalImpact" name="personalImpact" rows="5" 
                    placeholder="Share your story: Do you hear the gunfire from your home? Are you worried about evacuation routes? Do your kids ask about the shooting sounds? Have you changed your hiking routes? Has this affected your property value or peace of mind? The more specific you are, the more powerful your email will be."></textarea>
            </fieldset>

            <!-- Tone Selection -->
            <fieldset>
                <legend>Quick Draft Tone</legend>
                <div id="tone" class="radio-group"></div>
            </fieldset>

            <!-- Length/Style Selection -->
            <fieldset>
                <legend>Length/Style Options</legend>
                <div id="lengthStyle" class="radio-group"></div>
            </fieldset>

            <!-- Disclaimer -->
            <div style="background: #fff3cd; border: 2px solid #ffeaa7; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
                <h4 style="color: #856404; margin: 0 0 10px 0; font-size: var(--font-size-base);">Important Notice</h4>
                <div style="color: #856404; font-size: var(--font-size-sm); line-height: var(--line-height-relaxed);">
                    By using this tool, you acknowledge that:
                    <ul style="margin: 10px 0 0 0; padding-left: 20px;">
                        <li>The generated quick draft is a starting template that you should review and personalize</li>
                        <li>You are responsible for the accuracy of information you provide and send</li>
                        <li>This tool is for lawful civic engagement only</li>
                    </ul>
                </div>
            </div>

            <!-- Special field for form processing -->
            <div style="position: absolute; left: -5000px;" aria-hidden="true">
                <input type="text" name="website" tabindex="-1" autocomplete="off">
            </div>

            <!-- Submit -->
            <button type="submit" class="submit-button">Generate Quick Draft</button>
        </form>
    </div>

    <!-- Results Section -->
    <div id="results" class="results-container">
        <h2>Your Generated Quick Draft</h2>
        
        <!-- Email Body Display -->
        <div id="emailContent" class="email-content"></div>
        
        <!-- Action Buttons -->
        <div id="actionSection" style="margin-top: 20px;">
            <div class="action-buttons">
                <button id="emailButton" class="action-button email-button">
                    📧 Open in Email App
                </button>
                <button id="copyButton" class="action-button copy-button">
                    📋 Copy to Clipboard
                </button>
            </div>
        </div>
        
        <!-- Success/Instructions Section (hidden initially) -->
        <div id="successSection" style="display: none; margin-top: 20px; text-align: center;">
            <div style="padding: 20px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; margin-bottom: 15px;">
                <p style="margin: 0; color: #155724; font-size: var(--font-size-lg); font-weight: 600;">
                    ✓ Check your email app!
                </p>
            </div>
            <button id="copyInsteadButton" class="action-button copy-button" style="min-width: auto; padding: 10px 20px;">
                Didn't open? Copy instead
            </button>
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px; text-align: left;">
                <ul style="margin: 0; padding-left: 20px; line-height: var(--line-height-relaxed);">
                    <li>Review and personalize the message</li>
                    <li><strong>Add your mailing address after your name</strong></li>
                    <li>Make sure it sounds like you</li>
                </ul>
            </div>
        </div>
        
        <!-- Copy Details Section (hidden initially) -->
        <div id="copyDetailsSection" style="display: none; margin-top: 20px;">
            <div style="padding: 20px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px;">
                <h3 style="margin: 0 0 20px 0; color: #2c3e50; text-align: center;">📋 Copy These to Your Email App</h3>
                
                <div style="padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px; margin-bottom: 20px;">
                    <p style="margin: 0 0 10px 0; font-weight: 600; color: #856404;">
                        📝 Instructions:
                    </p>
                    <ol style="margin: 0; padding-left: 20px; color: #856404; line-height: var(--line-height-relaxed);">
                        <li>Copy each field below and paste into your email app</li>
                        <li>Personalize the message to reflect your voice</li>
                        <li><strong>Add your mailing address after your name</strong></li>
                        <li>Send to make your voice heard!</li>
                    </ol>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #2c3e50;">TO:</label>
                    <input type="text" id="toField" value="lletson@adacounty.id.gov, bocc1@adacounty.id.gov" readonly 
                           style="width: 100%; padding: 10px; font-family: monospace; background: white; border: 1px solid #dee2e6; border-radius: 4px; cursor: text; box-sizing: border-box;">
                    <button onclick="copyField('toField')" class="action-button field-copy-button" style="margin-top: 8px;">
                        Copy TO addresses
                    </button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #2c3e50;">SUBJECT:</label>
                    <input type="text" id="subjectField" value="" readonly 
                           style="width: 100%; padding: 10px; font-family: monospace; background: white; border: 1px solid #dee2e6; border-radius: 4px; cursor: text; box-sizing: border-box;">
                    <button onclick="copyField('subjectField')" class="action-button field-copy-button" style="margin-top: 8px;">
                        Copy Subject line
                    </button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #2c3e50;">BODY:</label>
                    <textarea id="bodyField" readonly 
                              style="width: 100%; padding: 10px; font-family: var(--font-primary); background: white; border: 1px solid #dee2e6; border-radius: 4px; min-height: 200px; resize: vertical; line-height: var(--line-height-relaxed); box-sizing: border-box;"></textarea>
                    <button onclick="copyField('bodyField')" class="action-button field-copy-button" style="margin-top: 8px;">
                        Copy Email body
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Share Tool Section -->
        <div class="share-tool-section" style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef; text-align: center;">
            <p style="margin: 0 0 15px 0; color: #666; font-style: italic;">
                Found this helpful? Share with neighbors who care about our community:
            </p>
            <button id="shareToolButton" style="background: #2c5282; color: white; border: none; padding: 10px 24px; border-radius: 6px; font-size: var(--font-size-base); cursor: pointer; transition: all 0.2s ease;">
                📤 Share This Tool
            </button>
        </div>
        
        <!-- Get Connected Section -->
        <div class="get-connected-section" style="margin-top: 30px; padding: 25px; background: #f8f9fa; border-radius: 8px; text-align: center;">
            <h3 style="margin: 0 0 10px 0; color: #2c3e50; font-size: var(--font-size-xl);">Stay Connected</h3>
            <p style="margin: 0 0 20px 0; color: #666;">
                Want to stay informed about the permit process and get updates on public hearings?
            </p>
            <a href="signup.html" style="display: inline-block; background: #28a745; color: white; text-decoration: none; padding: 12px 28px; border-radius: 6px; font-weight: 500; transition: all 0.2s ease;"
               onmouseover="this.style.background='#218838'" 
               onmouseout="this.style.background='#28a745'">
                Sign Up for Updates
            </a>
            <p style="margin: 15px 0 0 0; font-size: var(--font-size-sm); color: #6c757d;">
                Join our mailing list to receive important updates and action alerts
            </p>
        </div>
    </div>

    <script>
        // Configuration for form fields
        const formConfig = {
            residentType: {
                type: 'checkbox',
                options: [
                    { value: 'homeowner', label: 'Homeowner' },
                    { value: 'business_owner', label: 'Business Owner' },
                    { value: 'parent', label: 'Parent with children in nearby schools' },
                    { value: 'concerned_citizen', label: 'Concerned Citizen' },
                    { value: 'hiker', label: 'Hiker' },
                    { value: 'cyclist', label: 'Cyclist' },
                    { value: 'shooting_sports', label: 'Shooting Sports Enthusiast' },
                    { value: 'equestrian', label: 'Equestrian' }
                ]
            },
            distance: {
                type: 'radio',
                options: [
                    { value: 'less_than_1', label: 'Less than 1 mile' },
                    { value: '1_to_2', label: '1-2 miles' },
                    { value: '2_to_5', label: '2-5 miles' },
                    { value: 'more_than_5', label: 'More than 5 miles' }
                ]
            },
            concerns: {
                type: 'grouped',
                groups: {
                    'Safety & Emergency': [
                        { value: 'fire_risk', label: 'Fire risk/wildfire danger', definition: 'Sparks from shooting can ignite dry grass' },
                        { value: 'public_safety', label: 'Public safety concerns', definition: 'Bullets, ricochets, and accidents near people' },
                        { value: 'emergency_access', label: 'Emergency access/evacuation routes', definition: 'Traffic blocking escape roads' },
                        { value: 'safety_oversight', label: 'Lack of safety oversight', definition: 'No inspections or safety requirements' }
                    ],
                    'Legal & Governance': [
                        { value: 'legal_process', label: 'Disregard for legal process', definition: 'Operating illegally, ignoring enforcement' },
                        { value: 'precedent', label: 'Setting dangerous precedent', definition: 'Break rules now, get permits later' },
                        { value: 'zoning', label: 'Incompatible with zoning', definition: 'Commercial business in wrong area type' },
                        { value: 'liability', label: 'Liability/uninsured risks', definition: 'Who pays if accidents/fires happen?' }
                    ],
                    'Financial Impact': [
                        { value: 'property_values', label: 'Property value impacts', definition: 'Homes worth less near shooting ranges' },
                        { value: 'insurance_rates', label: 'Insurance rate impacts', definition: 'Higher premiums due to fire risk' }
                    ],
                    'Quality of Life': [
                        { value: 'noise_pollution', label: 'Noise pollution', definition: 'Constant gunfire disrupting peace' },
                        { value: 'quality_of_life', label: 'Quality of life degradation', definition: 'Daily stress, can\'t enjoy outdoors' },
                        { value: 'recreational_conflict', label: 'Conflict with recreational use', definition: 'Ruins hiking, biking, horseback riding' }
                    ],
                    'Infrastructure & Environment': [
                        { value: 'traffic', label: 'Increased traffic/road safety', definition: 'More vehicles on residential roads' },
                        { value: 'infrastructure', label: 'Stress on infrastructure', definition: 'Roads/utilities not built for businesses' },
                        { value: 'environment', label: 'Environmental/wildlife impact', definition: 'Lead contamination, disturbing animals' }
                    ]
                }
            },
            tone: {
                type: 'radio',
                options: [
                    { value: 'formal', label: 'Formal/Professional' },
                    { value: 'personal', label: 'Personal/Neighborly' },
                    { value: 'urgent', label: 'Urgent/Assertive' }
                ]
            },
            lengthStyle: {
                type: 'radio',
                options: [
                    { value: 'quick', label: 'Quick Note', definition: 'Get to the point fast (1-2 paragraphs)' },
                    { value: 'standard', label: 'Standard Email', definition: 'Balance of detail and brevity (3-4 paragraphs)' },
                    { value: 'thorough', label: 'Thorough Letter', definition: 'Complete argument with context (4-5 paragraphs)' }
                ]
            }
        };

        // Build form fields from config
        function buildFormFields() {
            Object.keys(formConfig).forEach(fieldName => {
                const config = formConfig[fieldName];
                const container = document.getElementById(fieldName);
                
                if (config.type === 'grouped') {
                    // Handle grouped checkboxes (concerns)
                    let optionIndex = 0;
                    Object.entries(config.groups).forEach(([groupName, options]) => {
                        // Create group header
                        const groupHeader = document.createElement('div');
                        groupHeader.style.cssText = 'font-weight: 600; color: #2c5282; margin: 15px 0 8px 0; font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.05em; grid-column: 1 / -1;';
                        groupHeader.textContent = groupName;
                        container.appendChild(groupHeader);
                        
                        // Create options
                        options.forEach((option) => {
                            const wrapper = document.createElement('div');
                            wrapper.className = 'checkbox-item';
                            wrapper.style.marginBottom = '12px';
                            
                            const input = document.createElement('input');
                            input.type = 'checkbox';
                            input.name = fieldName;
                            input.value = option.value;
                            input.id = `${fieldName}_${optionIndex}`;
                            
                            const labelWrapper = document.createElement('div');
                            labelWrapper.style.display = 'inline-block';
                            labelWrapper.style.verticalAlign = 'top';
                            labelWrapper.style.width = 'calc(100% - 30px)';
                            
                            const label = document.createElement('label');
                            label.htmlFor = `${fieldName}_${optionIndex}`;
                            label.style.fontWeight = '500';
                            label.style.display = 'block';
                            label.textContent = option.label;
                            
                            if (option.definition) {
                                const definition = document.createElement('span');
                                definition.style.cssText = 'display: block; font-size: var(--font-size-sm); color: #6c757d; font-weight: normal; margin-top: 2px;';
                                definition.textContent = option.definition;
                                labelWrapper.appendChild(label);
                                labelWrapper.appendChild(definition);
                            } else {
                                labelWrapper.appendChild(label);
                            }
                            
                            wrapper.appendChild(input);
                            wrapper.appendChild(labelWrapper);
                            container.appendChild(wrapper);
                            optionIndex++;
                        });
                    });
                } else if (config.options) {
                    // Handle regular options
                    config.options.forEach((option, index) => {
                        const wrapper = document.createElement('div');
                        wrapper.className = config.type === 'radio' ? 'radio-item' : 'checkbox-item';
                        
                        const input = document.createElement('input');
                        input.type = config.type;
                        input.name = fieldName;
                        input.value = option.value;
                        input.id = `${fieldName}_${index}`;
                        
                        // Set defaults
                        if (fieldName === 'tone' && index === 0) {
                            input.checked = true;
                        }
                        if (fieldName === 'lengthStyle' && option.value === 'standard') {
                            input.checked = true;
                        }
                        
                        const label = document.createElement('label');
                        label.htmlFor = `${fieldName}_${index}`;
                        
                        if (option.definition && fieldName === 'lengthStyle') {
                            // For lengthStyle, show label with definition
                            label.innerHTML = `<span style="font-weight: 500;">${option.label}</span> - <span style="color: #6c757d; font-size: var(--font-size-sm);">${option.definition}</span>`;
                        } else {
                            label.textContent = option.label;
                        }
                        
                        wrapper.appendChild(input);
                        wrapper.appendChild(label);
                        container.appendChild(wrapper);
                    });
                }
            });
        }

        // Build the prompt
        function buildPrompt(data) {
            const facilityContext = `
Key Facts about the Shooting Range:
- Location: 15401 N. Cartwright Rd, Boise (Foothills area)
- Access:  The range is on private property, one cannot drive by it, walk by it, etc.
- Type: Commercial shooting range with paid memberships and training courses
- Hours: Operates sporadically, but most often on Saturdays and weekday evenings. NEVER ALL DAY.
- Noise: Intense bursts of gunfire, periods of silence, more gunfire. 
- Status: Operating WITHOUT permits since 2024, now seeking approval
- Legal: They've been told to stop and they're not
- Defiance: Continues daily operations despite enforcement orders
- Fire Risk: A shooting range in the foothills is like an own goal.  It makes things worse, no matter what.
- Proximity: Less than 1 mile from residential areas and popular recreation trails
- Bad Outcomes: A major fire could burn 1000s of houses
- Hearing shots: Unless you are within 1.5 miles, you will never hear the gunshots
- Precedent Concern: Rewarding illegal operation with permits`;

            // Combine selected options with "other" fields
            let residentTypes = data.residentType.join(', ') || '';
            if (data.residentTypeOther) {
                residentTypes = residentTypes ? `${residentTypes}, ${data.residentTypeOther}` : data.residentTypeOther;
            }
            residentTypes = residentTypes || 'resident';
            
            // Build concerns with definitions for better context
            let concernsWithDefs = [];
            if (data.concerns.length > 0) {
                data.concerns.forEach(concern => {
                    // Find the concern definition
                    Object.values(formConfig.concerns.groups).forEach(group => {
                        const found = group.find(item => item.value === concern);
                        if (found) {
                            concernsWithDefs.push(`${found.label} (${found.definition})`);
                        }
                    });
                });
            }
            
            let concerns = concernsWithDefs.join(', ') || '';
            if (data.concernsOther) {
                concerns = concerns ? `${concerns}, ${data.concernsOther}` : data.concernsOther;
            }
            concerns = concerns || 'general concerns';
            
            const location = `${data.city}, ${data.state} ${data.zipcode}`;

            // Check if user provided their own words
            const hasOwnWords = data.personalImpact || data.residentTypeOther || data.concernsOther;
            
            const prompt = `Generate an email to Ada County officials regarding the non-compliant commercial shooting range seeking approval.

${hasOwnWords ? `CRITICAL INSTRUCTION: The writer has provided their own words below. YOUR PRIMARY JOB is to build the email around THEIR specific experiences and concerns, using THEIR language style and emphasizing THEIR personal details. The checkboxes they selected are just context - their written words are what matter most.

THE WRITER'S OWN WORDS:` : 'Writer Information:'}
${data.residentTypeOther ? `\nAbout themselves: "${data.residentTypeOther}"` : ''}
${data.concernsOther ? `\nTheir specific concerns: "${data.concernsOther}"` : ''}
${data.personalImpact ? `\nTheir personal story: "${data.personalImpact}"` : ''}

${hasOwnWords ? '\nAdditional context from form:' : ''}
- Name: ${data.name}
- Location: ${location}
- Status: ${residentTypes}
- Distance from facility: ${data.distance}
- Checkbox concerns selected: ${concerns}

${facilityContext}

OVERALL INSTRUCTIONS:
Tone Calibration Instructions:
- Avoid dramatic or flowery language like "shattered," "stark reminder," "devastate," etc.
- Use plain, direct language that real people would actually write
- Match dramatic intensity to the tone selected:
  
For Professional/Formal tone:
- Stick to facts and measured concerns
- Avoid emotional descriptors entirely
- Example: "The noise is disruptive" NOT "gunfire shatters our peace"

For Concerned Citizen tone:
- Some emotion is OK but keep it restrained
- Example: "We're worried about fire risk" NOT "one spark could devastate everything"

For Frustrated tone:
- Stronger language acceptable but still realistic
- Example: "This is unacceptable" NOT "blatant disregard"

General rules:
- Write like someone talking to their neighbor, not writing a novel
- Shorter sentences often sound more authentic
- One "dramatic" point per email maximum
- Let their actual concerns speak for themselves without embellishment

Bad: "The constant gunfire echoing through our Rolling Hills neighborhood has shattered the peaceful environment"
Good: "We hear gunfire regularly from our home in Rolling Hills. It's gotten really disruptive."

Bad: "stark reminder of what's at stake"
Good: "shows what could happen here"

Bad: "we experience rapid-fire discharge that penetrate our home's walls"
Good:  "outside we regularly hear rapid-fire discharge"

Generate BOTH a subject line and email body:

For the SUBJECT: ${hasOwnWords ? 
  'Create a subject line that reflects the specific concerns and experiences they wrote about in their own words, while ensuring it mentions "shooting range," "gun range," or "firing range" so officials know the topic' : 
  'Create a unique, specific subject line based on the writer\'s primary concerns and situation that clearly identifies this is about the shooting/gun/firing range'}

Subject line should:
- Always include some reference to the "shooting range," "gun range," or "firing range" - vary usage
- Match the tone/style (formal emails may include Case #202501185-CU-MSP, casual ones should not)
- Reflect the writer's specific angle (fire worry = fire in subject, noise concern = noise in subject) but still try to vary the wording
- Be unique to avoid pattern detection, vary the use of language, match the tone of the email body

Examples: 
- Formal: "Re: Case #202501185-CU-MSP - Fire Safety Concerns"
- Personal: "My Dog Hides from the Cartwright Gun Range Noise"
- Urgent: "Daily Illegal Shooting Range Operations Must Stop"

For the BODY: ${hasOwnWords ? `
IMPORTANT: Build the email around the personal details they provided. Use their specific examples, mirror their writing style, and expand on the concerns they expressed. The email should feel like a natural extension of what they wrote.

Specific instructions:
- Start with their personal connection/story if they provided one
- Use the specific examples they gave (gunfire during dinner, dog scared, etc.)
- Mirror their tone - if they said "pisses me off", be direct; if they said "deeply concerned", be formal
- Expand on THEIR concerns, not generic ones
- Make sure every concern they wrote about is addressed` : `
Write a compelling email that:
1. Introduces the writer and their stake in the issue
2. Expresses specific concerns (emphasizing their top priorities: ${concerns})
3. References the inherent risks, public safety concerns, and impact on quiet enjoyment`}
4. Requests denial of the permit application
5. ${hasOwnWords ? 'Match the tone of their written input - formal if they were formal, casual if they were casual' : 'MAINTAINS a RESPECTFUL but firm tone'}
6. ${hasOwnWords ? 'Build on their personal details without inventing new ones' : 'Adding color and personality is fine, but don\'t make up personal stories'}
7. These emails are going to city officials
8. End with a natural sign-off that matches the tone and style of the email. Let the closing feel authentic to how this person would actually sign their email.

Length requirement: ${data.lengthStyle === 'quick' ? 'Keep it brief - 1-2 paragraphs only, get straight to the point' :
                    data.lengthStyle === 'thorough' ? 'Write a thorough letter with 4-5 paragraphs, include context and detailed arguments' :
                    'Standard length - 3-4 paragraphs with good balance of detail'}

${hasOwnWords ? 'Remember: Their own words are the foundation. Everything else supports their personal narrative.' : 'The email should be personal and authentic, not generic.'}

Tone: ${data.tone === 'formal' ? 'Use formal, professional language' : 
       data.tone === 'personal' ? 'Use warm, neighborly language that emphasizes community' :
       'Use urgent, assertive language that conveys serious concern'}`;

            return prompt;
        }

        // Form submission handler
        async function handleSubmit(e) {
            e.preventDefault();
            
            const submitButton = e.target.querySelector('.submit-button');
            const originalText = submitButton.textContent;
            submitButton.innerHTML = 'Generating your unique email... please wait while AI crafts your personalized message<br><span style="font-size: 0.9em; opacity: 0.9;">(10-15 seconds)</span>';
            submitButton.disabled = true;
            
            // Collect form data
            const formData = new FormData(e.target);
            
            // Check special field
            if (formData.get('website')) {
                // Invalid submission - fail silently
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
                return;
            }
            
            const data = {
                name: formData.get('name'),
                city: formData.get('city'),
                state: formData.get('state'),
                zipcode: formData.get('zipcode'),
                residentType: formData.getAll('residentType'),
                residentTypeOther: formData.get('residentTypeOther'),
                distance: formData.get('distance'),
                concerns: formData.getAll('concerns'),
                concernsOther: formData.get('concernsOther'),
                personalImpact: formData.get('personalImpact'),
                tone: formData.get('tone'),
                lengthStyle: formData.get('lengthStyle')
            };
            
            // Validate selections
            if (data.residentType.length === 0 && !data.residentTypeOther) {
                alert('Please select at least one option for "I am a..." or fill in "Other"');
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
                return;
            }
            
            if (!data.distance) {
                alert('Please select your distance from the shooting range');
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
                return;
            }
            
            if (data.concerns.length === 0 && !data.concernsOther) {
                alert('Please select at least one concern or fill in "Other concerns"');
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
                return;
            }
            
            // Build the prompt
            const prompt = buildPrompt(data);
            
            try {
                // Call Netlify function with the ready prompt
                // Use local endpoint when running on localhost
                const apiUrl = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                    ? '/.netlify/functions/generate-email'  // Local relative path
                    : 'https://brilliant-muffin-f02696.netlify.app/.netlify/functions/generate-email';  // Production
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt }),
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // Store subject globally
                    generatedSubject = result.subject;
                    
                    // Display only email body
                    document.getElementById('emailContent').textContent = result.email;
                    document.getElementById('results').style.display = 'block';
                    
                    // Reset sections to initial state
                    document.getElementById('actionSection').style.display = 'block';
                    document.getElementById('successSection').style.display = 'none';
                    document.getElementById('copyDetailsSection').style.display = 'none';
                    
                    // Scroll to results
                    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('Error: ' + (result.error || 'Failed to generate email'));
                }
            } catch (error) {
                alert('Failed to generate email. Please try again.');
            } finally {
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            }
        }

        // Store the generated subject globally
        let generatedSubject = '';

        // Copy to clipboard handler
        function copyToClipboard() {
            const content = document.getElementById('emailContent').textContent;
            
            // Populate all fields
            document.getElementById('subjectField').value = generatedSubject;
            document.getElementById('bodyField').value = content;
            
            // Show copy details section
            document.getElementById('copyDetailsSection').style.display = 'block';
            
            // Scroll to copy section
            document.getElementById('copyDetailsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Email client handler
        function openEmailClient() {
            const content = document.getElementById('emailContent').textContent;
            
            // Email addresses
            const to = 'lletson@adacounty.id.gov,bocc1@adacounty.id.gov';
            const mailto = `mailto:${to}?subject=${encodeURIComponent(generatedSubject)}&body=${encodeURIComponent(content)}`;
            
            window.location.href = mailto;
            
            // Show success section and hide action buttons
            document.getElementById('actionSection').style.display = 'none';
            document.getElementById('successSection').style.display = 'block';
        }
        
        // Copy individual fields
        function copyField(fieldId) {
            const field = document.getElementById(fieldId);
            const value = field.value;
            
            navigator.clipboard.writeText(value).then(() => {
                // Find the button (next sibling element)
                const button = field.nextElementSibling;
                const originalText = button.textContent;
                button.textContent = '✓ Copied!';
                button.style.background = '#28a745';
                button.style.color = 'white';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                    button.style.color = '';
                }, 2000);
            }).catch(() => {
                alert('Failed to copy. Please select and copy manually.');
            });
        }

        // Share tool functionality
        async function shareTool() {
            const shareData = {
                title: 'Help Stop the Non-compliant Shooting Range',
                text: 'I found this tool that makes it easy to email Ada County officials about the shooting range. Check it out:',
                url: window.location.href
            };
            
            if (navigator.share) {
                try {
                    await navigator.share(shareData);
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        // Fallback to copying link
                        copyToolLink();
                    }
                }
            } else {
                // Fallback for desktop - copy link
                copyToolLink();
            }
        }
        
        function copyToolLink() {
            const toolUrl = window.location.href;
            navigator.clipboard.writeText(toolUrl).then(() => {
                const button = document.getElementById('shareToolButton');
                const originalText = button.innerHTML;
                button.innerHTML = '✓ Link Copied!';
                button.style.background = '#28a745';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = '#2c5282';
                }, 2000);
            }).catch(() => {
                // Fallback fallback - show URL
                alert('Share this link: ' + toolUrl);
            });
        }

        // Test mode - pre-fill form if ?test=true
        function checkTestMode() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('test') === 'true') {
                // Pre-fill form with test data
                document.getElementById('name').value = 'Test User';
                document.getElementById('city').value = 'Boise';
                document.getElementById('state').value = 'ID';
                document.getElementById('zipcode').value = '83714';
                
                // Check some boxes
                document.querySelector('input[name="residentType"][value="homeowner"]').checked = true;
                document.querySelector('input[name="residentType"][value="hiker"]').checked = true;
                document.querySelector('input[name="distance"][value="1_to_2"]').checked = true;
                document.querySelector('input[name="concerns"][value="fire_risk"]').checked = true;
                document.querySelector('input[name="concerns"][value="noise_pollution"]').checked = true;
                document.querySelector('input[name="tone"][value="formal"]').checked = true;
                document.querySelector('input[name="lengthStyle"][value="standard"]').checked = true;
                
                document.getElementById('personalImpact').value = 'I hike these trails with my family every weekend.';
                
                // Add visual indicator
                document.querySelector('.header').style.border = '3px solid #ff6b6b';
                const testBadge = document.createElement('div');
                testBadge.style.cssText = 'position: fixed; top: 10px; right: 10px; background: #ff6b6b; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; z-index: 1000;';
                testBadge.textContent = 'TEST MODE';
                document.body.appendChild(testBadge);
            }
        }

        // Copy instead button handler
        function handleCopyInstead() {
            // Hide success section, show action section
            document.getElementById('successSection').style.display = 'none';
            document.getElementById('actionSection').style.display = 'block';
            
            // Trigger copy action
            copyToClipboard();
        }

        // Initialize
        buildFormFields();
        checkTestMode();
        document.getElementById('emailForm').addEventListener('submit', handleSubmit);
        document.getElementById('copyButton').addEventListener('click', copyToClipboard);
        document.getElementById('emailButton').addEventListener('click', openEmailClient);
        document.getElementById('shareToolButton').addEventListener('click', shareTool);
        document.getElementById('copyInsteadButton').addEventListener('click', handleCopyInstead);
    </script>
</body>
</html>