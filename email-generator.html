<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Draft Generator - Foothills Fire Prevention</title>
    <style>
        /* Typography System - Shared from main site */
        :root {
            --font-primary: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-size-base: 16px;
            --font-size-sm: 0.875rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 2rem;
            --font-size-4xl: 2.5rem;
            --line-height-tight: 1.25;
            --line-height-base: 1.6;
            --line-height-relaxed: 1.75;
            --letter-spacing-tight: -0.025em;
            --letter-spacing-wide: 0.025em;
        }
        
        body {
            font-family: var(--font-primary);
            font-size: var(--font-size-base);
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: var(--line-height-base);
            color: #2c3e50;
            background: #f8f9fa;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Header - Simplified version */
        .header {
            background: linear-gradient(135deg, #1a2332 0%, #2c3e50 60%, #c9302c 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header h1 {
            margin: 0 0 10px 0;
            font-size: var(--font-size-3xl);
            font-weight: 700;
            letter-spacing: var(--letter-spacing-tight);
        }
        .header p {
            margin: 0;
            font-size: var(--font-size-lg);
            opacity: 0.95;
        }

        /* Back link */
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #2c5282;
            text-decoration: none;
            font-size: var(--font-size-sm);
            font-weight: 500;
        }
        .back-link:hover {
            text-decoration: underline;
        }

        /* Form Container */
        .form-container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* Form Styles */
        form {
            margin: 0;
        }
        
        fieldset {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            background: #fafbfc;
        }
        
        legend {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: #1a2332;
            padding: 0 10px;
            margin-bottom: 15px;
        }
        
        /* Input Groups */
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group:last-child {
            margin-bottom: 0;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
            font-size: var(--font-size-base);
        }
        
        input[type="text"],
        input[type="email"],
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: var(--font-size-base);
            font-family: var(--font-primary);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            box-sizing: border-box;
        }
        
        input[type="text"]:focus,
        input[type="email"]:focus,
        textarea:focus {
            outline: none;
            border-color: #2c5282;
            box-shadow: 0 0 0 3px rgba(44, 82, 130, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Radio and Checkbox Styles */
        .radio-group,
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .radio-item,
        .checkbox-item {
            display: flex;
            align-items: center;
        }
        
        input[type="radio"],
        input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .radio-item label,
        .checkbox-item label {
            margin-bottom: 0;
            cursor: pointer;
            font-weight: normal;
        }

        /* Two Column Layout for Checkboxes */
        #residentType {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        /* Concerns layout - single column for better grouped display */
        #concerns {
            display: block;
        }
        
        #concerns .checkbox-item {
            margin-left: 20px;
            margin-bottom: 8px;
        }

        /* Submit Button */
        .submit-button {
            background: #c9302c;
            color: white;
            padding: 16px 40px;
            border: none;
            border-radius: 6px;
            font-size: var(--font-size-lg);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(201, 48, 44, 0.2);
            width: 100%;
        }
        
        .submit-button:hover {
            background: #a02622;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(201, 48, 44, 0.3);
        }
        
        .submit-button:active {
            transform: translateY(0);
        }

        /* Loading State */
        .submit-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        /* Results Section */
        .results-container {
            display: none;
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .results-container h2 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #1a2332;
            font-size: var(--font-size-2xl);
        }
        
        .email-subject {
            font-weight: 600;
            color: #2c5282;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #2c5282;
        }
        
        .email-content {
            white-space: pre-wrap;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            margin-bottom: 20px;
            font-family: var(--font-primary);
            line-height: var(--line-height-relaxed);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .action-button {
            flex: 1;
            min-width: 200px;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: var(--font-size-base);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            text-decoration: none;
        }
        
        .copy-button {
            background: #2c5282;
            color: white;
        }
        
        .copy-button:hover {
            background: #1e3a5f;
            transform: translateY(-2px);
        }
        
        .email-button {
            background: white;
            color: #2c5282;
            border: 2px solid #2c5282;
        }
        
        .email-button:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
        }
        
        .share-button:hover {
            background: #365899 !important;
            transform: translateY(-2px);
        }

        /* Error Message */
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        /* Success Message */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            .header {
                padding: 25px 20px;
            }
            
            .header h1 {
                font-size: var(--font-size-2xl);
            }
            
            .form-container,
            .results-container {
                padding: 20px;
            }
            
            fieldset {
                padding: 15px;
            }
            
            #residentType {
                grid-template-columns: 1fr;
            }
            
            #concerns .checkbox-item {
                margin-left: 15px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-button {
                width: 100%;
            }
        }

        /* Small mobile */
        @media (max-width: 480px) {
            .submit-button {
                padding: 14px 20px;
                font-size: var(--font-size-base);
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← Back to Main Page</a>
    
    <div class="header">
        <h1>Speak Up About the Non-compliant Shooting Range</h1>
        <p>Generate a personalized quick draft to Ada County officials in minutes</p>
    </div>
    
    <div class="intro-container" style="background: white; border-radius: 8px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
        <p style="font-size: var(--font-size-lg); font-weight: 500; color: #1a2332; margin-bottom: 20px;">
            Writing to county officials about your concerns is one of the most effective ways to influence this decision. A personal email in your own words carries the most weight.
        </p>
        
        <p style="margin-bottom: 20px;">
            <strong>How this tool helps:</strong> We know that starting an email can be the hardest part. This form uses AI to create a quick draft based on your specific situation and concerns. Think of it as a starting point - not a final product.
        </p>
        
        <h3 style="font-size: var(--font-size-xl); margin-bottom: 15px;">Here's how it works:</h3>
        <ol style="margin-bottom: 20px; padding-left: 25px; line-height: var(--line-height-relaxed);">
            <li>Fill out the form below with your information and concerns</li>
            <li>Click "Generate Quick Draft" to create a personalized draft</li>
            <li>Review the draft and edit it to match your voice</li>
            <li>Copy the final version and send it to Ada County officials</li>
        </ol>
        
        <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
            <p style="margin: 0; font-style: italic;">
                <strong>Remember:</strong> The generated quick draft is just a template. Adding your personal experiences and editing it to sound like you will make it more impactful. Officials can tell the difference between form letters and genuine constituent concerns.
            </p>
        </div>
        
        <p style="margin: 0; font-size: var(--font-size-lg); text-align: center; color: #2c5282; font-weight: 500;">
            Ready? Let's help you get started on your quick draft.
        </p>
    </div>
    
    <div class="form-container">
        <form id="emailForm">
            <!-- Basic Information -->
            <fieldset>
                <legend>Your Information</legend>
                
                <div class="input-group">
                    <label for="name">Name (required)</label>
                    <input type="text" id="name" name="name" required>
                </div>
                
                <div class="input-group">
                    <label for="city">City (required)</label>
                    <input type="text" id="city" name="city" required>
                </div>
                
                <div class="input-group">
                    <label for="state">State (required)</label>
                    <input type="text" id="state" name="state" required value="ID">
                </div>
                
                <div class="input-group">
                    <label for="zipcode">Zipcode (required)</label>
                    <input type="text" id="zipcode" name="zipcode" required pattern="[0-9]{5}" placeholder="83714">
                </div>
            </fieldset>

            <!-- Resident Type -->
            <fieldset>
                <legend>I am a... (check all that apply)</legend>
                <div id="residentType" class="checkbox-group"></div>
                <div class="input-group" style="margin-top: 15px;">
                    <label for="residentTypeOther">Other (please specify):</label>
                    <input type="text" id="residentTypeOther" name="residentTypeOther" 
                           placeholder="e.g., local teacher, volunteer firefighter, etc.">
                </div>
            </fieldset>

            <!-- Distance from Facility -->
            <fieldset>
                <legend>Distance from 15401 N. Cartwright Rd.</legend>
                <div id="distance" class="radio-group"></div>
            </fieldset>

            <!-- Primary Concerns -->
            <fieldset>
                <legend>What are your primary concerns? (check all that apply)</legend>
                <div id="concerns" class="checkbox-group"></div>
                <div class="input-group" style="margin-top: 15px;">
                    <label for="concernsOther">Other concerns (please specify):</label>
                    <input type="text" id="concernsOther" name="concernsOther" 
                           placeholder="e.g., impact on local businesses, emergency evacuation routes, etc.">
                </div>
            </fieldset>

            <!-- Personal Impact -->
            <fieldset>
                <legend>Personal Impact</legend>
                <label for="personalImpact">How does this affect you personally? (optional)</label>
                <textarea id="personalImpact" name="personalImpact" rows="4" 
                    placeholder="Example: I hike the trails weekly with my family..."></textarea>
            </fieldset>

            <!-- Tone Selection -->
            <fieldset>
                <legend>Quick Draft Tone</legend>
                <div id="tone" class="radio-group"></div>
            </fieldset>

            <!-- Length/Style Selection -->
            <fieldset>
                <legend>Length/Style Options</legend>
                <div id="lengthStyle" class="radio-group"></div>
            </fieldset>

            <!-- Disclaimer -->
            <div style="background: #fff3cd; border: 2px solid #ffeaa7; border-radius: 8px; padding: 20px; margin-bottom: 25px;">
                <h4 style="color: #856404; margin: 0 0 10px 0; font-size: var(--font-size-base);">Important Notice</h4>
                <div style="color: #856404; font-size: var(--font-size-sm); line-height: var(--line-height-relaxed);">
                    By using this tool, you acknowledge that:
                    <ul style="margin: 10px 0 0 0; padding-left: 20px;">
                        <li>The generated quick draft is a starting template that you should review and personalize</li>
                        <li>You are responsible for the accuracy of information you provide and send</li>
                        <li>This tool is for lawful civic engagement only</li>
                    </ul>
                </div>
            </div>

            <!-- Special field for form processing -->
            <div style="position: absolute; left: -5000px;" aria-hidden="true">
                <input type="text" name="website" tabindex="-1" autocomplete="off">
            </div>

            <!-- Submit -->
            <button type="submit" class="submit-button">Generate Quick Draft</button>
        </form>
    </div>

    <!-- Results Section -->
    <div id="results" class="results-container">
        <h2>Your Generated Quick Draft</h2>
        <div id="emailSubject" class="email-subject"></div>
        <div id="emailContent" class="email-content"></div>
        <div class="action-buttons">
            <button id="copyButton" class="action-button copy-button">Copy to Clipboard</button>
            <button id="emailButton" class="action-button email-button">Open in Email Client</button>
        </div>
        
        <!-- Share Tool Section -->
        <div class="share-tool-section" style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef; text-align: center;">
            <p style="margin: 0 0 15px 0; color: #666; font-style: italic;">
                Found this helpful? Share with neighbors who care about our community:
            </p>
            <button id="shareToolButton" style="background: #2c5282; color: white; border: none; padding: 10px 24px; border-radius: 6px; font-size: var(--font-size-base); cursor: pointer; transition: all 0.2s ease;">
                📤 Share This Tool
            </button>
        </div>
        
        <!-- Get Connected Section -->
        <div class="get-connected-section" style="margin-top: 30px; padding: 25px; background: #f8f9fa; border-radius: 8px; text-align: center;">
            <h3 style="margin: 0 0 10px 0; color: #2c3e50; font-size: var(--font-size-xl);">Stay Connected</h3>
            <p style="margin: 0 0 20px 0; color: #666;">
                Want to stay informed about the permit process and get updates on public hearings?
            </p>
            <a href="signup.html" style="display: inline-block; background: #28a745; color: white; text-decoration: none; padding: 12px 28px; border-radius: 6px; font-weight: 500; transition: all 0.2s ease;"
               onmouseover="this.style.background='#218838'" 
               onmouseout="this.style.background='#28a745'">
                Sign Up for Updates
            </a>
            <p style="margin: 15px 0 0 0; font-size: var(--font-size-sm); color: #6c757d;">
                Join our mailing list to receive important updates and action alerts
            </p>
        </div>
    </div>

    <script>
        // Configuration for form fields
        const formConfig = {
            residentType: {
                type: 'checkbox',
                options: [
                    { value: 'homeowner', label: 'Homeowner' },
                    { value: 'business_owner', label: 'Business Owner' },
                    { value: 'parent', label: 'Parent with children in nearby schools' },
                    { value: 'concerned_citizen', label: 'Concerned Citizen' },
                    { value: 'hiker', label: 'Hiker' },
                    { value: 'cyclist', label: 'Cyclist' },
                    { value: 'shooting_sports', label: 'Shooting Sports Enthusiast' },
                    { value: 'equestrian', label: 'Equestrian' }
                ]
            },
            distance: {
                type: 'radio',
                options: [
                    { value: 'less_than_1', label: 'Less than 1 mile' },
                    { value: '1_to_2', label: '1-2 miles' },
                    { value: '2_to_5', label: '2-5 miles' },
                    { value: 'more_than_5', label: 'More than 5 miles' }
                ]
            },
            concerns: {
                type: 'grouped',
                groups: {
                    'Safety & Emergency': [
                        { value: 'fire_risk', label: 'Fire risk/wildfire danger', definition: 'Sparks from shooting can ignite dry grass' },
                        { value: 'public_safety', label: 'Public safety concerns', definition: 'Bullets, ricochets, and accidents near people' },
                        { value: 'emergency_access', label: 'Emergency access/evacuation routes', definition: 'Traffic blocking escape roads' },
                        { value: 'safety_oversight', label: 'Lack of safety oversight', definition: 'No inspections or safety requirements' }
                    ],
                    'Legal & Governance': [
                        { value: 'legal_process', label: 'Disregard for legal process', definition: 'Operating illegally, ignoring enforcement' },
                        { value: 'precedent', label: 'Setting dangerous precedent', definition: 'Break rules now, get permits later' },
                        { value: 'zoning', label: 'Incompatible with zoning', definition: 'Commercial business in wrong area type' },
                        { value: 'liability', label: 'Liability/uninsured risks', definition: 'Who pays if accidents/fires happen?' }
                    ],
                    'Financial Impact': [
                        { value: 'property_values', label: 'Property value impacts', definition: 'Homes worth less near shooting ranges' },
                        { value: 'insurance_rates', label: 'Insurance rate impacts', definition: 'Higher premiums due to fire risk' }
                    ],
                    'Quality of Life': [
                        { value: 'noise_pollution', label: 'Noise pollution', definition: 'Constant gunfire disrupting peace' },
                        { value: 'quality_of_life', label: 'Quality of life degradation', definition: 'Daily stress, can\'t enjoy outdoors' },
                        { value: 'recreational_conflict', label: 'Conflict with recreational use', definition: 'Ruins hiking, biking, horseback riding' }
                    ],
                    'Infrastructure & Environment': [
                        { value: 'traffic', label: 'Increased traffic/road safety', definition: 'More vehicles on residential roads' },
                        { value: 'infrastructure', label: 'Stress on infrastructure', definition: 'Roads/utilities not built for businesses' },
                        { value: 'environment', label: 'Environmental/wildlife impact', definition: 'Lead contamination, disturbing animals' }
                    ]
                }
            },
            tone: {
                type: 'radio',
                options: [
                    { value: 'formal', label: 'Formal/Professional' },
                    { value: 'personal', label: 'Personal/Neighborly' },
                    { value: 'urgent', label: 'Urgent/Assertive' }
                ]
            },
            lengthStyle: {
                type: 'radio',
                options: [
                    { value: 'quick', label: 'Quick Note', definition: 'Get to the point fast (1-2 paragraphs)' },
                    { value: 'standard', label: 'Standard Email', definition: 'Balance of detail and brevity (3-4 paragraphs)' },
                    { value: 'thorough', label: 'Thorough Letter', definition: 'Complete argument with context (4-5 paragraphs)' }
                ]
            }
        };

        // Build form fields from config
        function buildFormFields() {
            Object.keys(formConfig).forEach(fieldName => {
                const config = formConfig[fieldName];
                const container = document.getElementById(fieldName);
                
                if (config.type === 'grouped') {
                    // Handle grouped checkboxes (concerns)
                    let optionIndex = 0;
                    Object.entries(config.groups).forEach(([groupName, options]) => {
                        // Create group header
                        const groupHeader = document.createElement('div');
                        groupHeader.style.cssText = 'font-weight: 600; color: #2c5282; margin: 15px 0 8px 0; font-size: var(--font-size-sm); text-transform: uppercase; letter-spacing: 0.05em; grid-column: 1 / -1;';
                        groupHeader.textContent = groupName;
                        container.appendChild(groupHeader);
                        
                        // Create options
                        options.forEach((option) => {
                            const wrapper = document.createElement('div');
                            wrapper.className = 'checkbox-item';
                            wrapper.style.marginBottom = '12px';
                            
                            const input = document.createElement('input');
                            input.type = 'checkbox';
                            input.name = fieldName;
                            input.value = option.value;
                            input.id = `${fieldName}_${optionIndex}`;
                            
                            const labelWrapper = document.createElement('div');
                            labelWrapper.style.display = 'inline-block';
                            labelWrapper.style.verticalAlign = 'top';
                            labelWrapper.style.width = 'calc(100% - 30px)';
                            
                            const label = document.createElement('label');
                            label.htmlFor = `${fieldName}_${optionIndex}`;
                            label.style.fontWeight = '500';
                            label.style.display = 'block';
                            label.textContent = option.label;
                            
                            if (option.definition) {
                                const definition = document.createElement('span');
                                definition.style.cssText = 'display: block; font-size: var(--font-size-sm); color: #6c757d; font-weight: normal; margin-top: 2px;';
                                definition.textContent = option.definition;
                                labelWrapper.appendChild(label);
                                labelWrapper.appendChild(definition);
                            } else {
                                labelWrapper.appendChild(label);
                            }
                            
                            wrapper.appendChild(input);
                            wrapper.appendChild(labelWrapper);
                            container.appendChild(wrapper);
                            optionIndex++;
                        });
                    });
                } else if (config.options) {
                    // Handle regular options
                    config.options.forEach((option, index) => {
                        const wrapper = document.createElement('div');
                        wrapper.className = config.type === 'radio' ? 'radio-item' : 'checkbox-item';
                        
                        const input = document.createElement('input');
                        input.type = config.type;
                        input.name = fieldName;
                        input.value = option.value;
                        input.id = `${fieldName}_${index}`;
                        
                        // Set defaults
                        if (fieldName === 'tone' && index === 0) {
                            input.checked = true;
                        }
                        if (fieldName === 'lengthStyle' && option.value === 'standard') {
                            input.checked = true;
                        }
                        
                        const label = document.createElement('label');
                        label.htmlFor = `${fieldName}_${index}`;
                        
                        if (option.definition && fieldName === 'lengthStyle') {
                            // For lengthStyle, show label with definition
                            label.innerHTML = `<span style="font-weight: 500;">${option.label}</span> - <span style="color: #6c757d; font-size: var(--font-size-sm);">${option.definition}</span>`;
                        } else {
                            label.textContent = option.label;
                        }
                        
                        wrapper.appendChild(input);
                        wrapper.appendChild(label);
                        container.appendChild(wrapper);
                    });
                }
            });
        }

        // Build the prompt
        function buildPrompt(data) {
            const facilityContext = `
Key Facts about the Shooting Range:
- Location: 15401 N. Cartwright Rd, Boise (Foothills area)
- Type: Commercial shooting range with paid memberships and training courses
- Status: Operating WITHOUT permits since 2024, now seeking approval
- Legal: Ada County Sheriff and Prosecutor have issued enforcement orders to cease operations
- Defiance: Continues daily operations despite enforcement orders
- Fire Risk: 1996 Boise foothills fire (14,000 acres) started at a shooting range
- Proximity: Less than 1 mile from residential areas and popular recreation trails
- Precedent Concern: Rewarding illegal operation with permits`;

            // Combine selected options with "other" fields
            let residentTypes = data.residentType.join(', ') || '';
            if (data.residentTypeOther) {
                residentTypes = residentTypes ? `${residentTypes}, ${data.residentTypeOther}` : data.residentTypeOther;
            }
            residentTypes = residentTypes || 'resident';
            
            // Build concerns with definitions for better context
            let concernsWithDefs = [];
            if (data.concerns.length > 0) {
                data.concerns.forEach(concern => {
                    // Find the concern definition
                    Object.values(formConfig.concerns.groups).forEach(group => {
                        const found = group.find(item => item.value === concern);
                        if (found) {
                            concernsWithDefs.push(`${found.label} (${found.definition})`);
                        }
                    });
                });
            }
            
            let concerns = concernsWithDefs.join(', ') || '';
            if (data.concernsOther) {
                concerns = concerns ? `${concerns}, ${data.concernsOther}` : data.concernsOther;
            }
            concerns = concerns || 'general concerns';
            
            const location = `${data.city}, ${data.state} ${data.zipcode}`;

            const prompt = `Generate an email to Ada County officials regarding the non-compliant commercial shooting range seeking approval.

Writer Information:
- Name: ${data.name}
- Location: ${location}
- Status: ${residentTypes}
- Distance from facility: ${data.distance}
- Primary concerns: ${concerns}
${data.personalImpact ? `- Personal impact: ${data.personalImpact}` : ''}

${facilityContext}

Generate BOTH a subject line and email body:

For the SUBJECT: Create a unique, specific subject line based on the writer's primary concerns and situation. Examples:
- "Fire Safety Concerns from Longtime Foothills Resident"
- "Parent's Perspective on Shooting Range Near Schools"
- "Protecting Our Trails and Wildlife - Please Deny Permit"

For the BODY: Write a compelling email that:
1. Introduces the writer and their stake in the issue
2. Expresses specific concerns (emphasizing their top priorities: ${concerns})
3. References the inherent risks, public safety concerns, and impact on quiet enjoyment
4. Requests denial of the permit application
5. MAINTAINS a RESPECTFUL but firm tone

Length requirement: ${data.lengthStyle === 'quick' ? 'Keep it brief - 1-2 paragraphs only, get straight to the point' :
                    data.lengthStyle === 'thorough' ? 'Write a thorough letter with 4-5 paragraphs, include context and detailed arguments' :
                    'Standard length - 3-4 paragraphs with good balance of detail'}


The email should be personal and authentic, not generic.

Tone: ${data.tone === 'formal' ? 'Use formal, professional language' : 
       data.tone === 'personal' ? 'Use warm, neighborly language that emphasizes community' :
       'Use urgent, assertive language that conveys serious concern'}`;

            return prompt;
        }

        // Form submission handler
        async function handleSubmit(e) {
            e.preventDefault();
            
            const submitButton = e.target.querySelector('.submit-button');
            const originalText = submitButton.textContent;
            submitButton.textContent = 'Generating...';
            submitButton.disabled = true;
            
            // Collect form data
            const formData = new FormData(e.target);
            
            // Check special field
            if (formData.get('website')) {
                // Invalid submission - fail silently
                submitButton.textContent = originalText;
                submitButton.disabled = false;
                return;
            }
            
            const data = {
                name: formData.get('name'),
                city: formData.get('city'),
                state: formData.get('state'),
                zipcode: formData.get('zipcode'),
                residentType: formData.getAll('residentType'),
                residentTypeOther: formData.get('residentTypeOther'),
                distance: formData.get('distance'),
                concerns: formData.getAll('concerns'),
                concernsOther: formData.get('concernsOther'),
                personalImpact: formData.get('personalImpact'),
                tone: formData.get('tone'),
                lengthStyle: formData.get('lengthStyle')
            };
            
            // Validate selections
            if (data.residentType.length === 0 && !data.residentTypeOther) {
                alert('Please select at least one option for "I am a..." or fill in "Other"');
                submitButton.textContent = originalText;
                submitButton.disabled = false;
                return;
            }
            
            if (!data.distance) {
                alert('Please select your distance from the facility');
                submitButton.textContent = originalText;
                submitButton.disabled = false;
                return;
            }
            
            if (data.concerns.length === 0 && !data.concernsOther) {
                alert('Please select at least one concern or fill in "Other concerns"');
                submitButton.textContent = originalText;
                submitButton.disabled = false;
                return;
            }
            
            // Build the prompt
            const prompt = buildPrompt(data);
            
            try {
                // Call Netlify function with the ready prompt
                const response = await fetch('https://brilliant-muffin-f02696.netlify.app/.netlify/functions/generate-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt }),
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // Display results
                    document.getElementById('emailSubject').textContent = 'Subject: ' + result.subject;
                    document.getElementById('emailContent').textContent = result.email;
                    document.getElementById('results').style.display = 'block';
                    
                    // Scroll to results
                    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('Error: ' + (result.error || 'Failed to generate email'));
                }
            } catch (error) {
                // For local testing, generate a mock response
                if (window.location.hostname === 'localhost' || window.location.protocol === 'file:') {
                    const mockEmail = `Dear Ada County Commissioners,

My name is ${data.name}, and I am writing as a ${data.residentType.join(' and ')} living ${data.distance.replace(/_/g, ' ')} from the proposed burn facility at 15401 N. Cartwright Rd.

I am deeply concerned about this facility for several reasons, particularly ${concerns}.

${data.personalImpact || 'This facility would significantly impact our community and quality of life.'}

I strongly urge you to deny the permit for this facility and protect our community's safety and well-being.

Sincerely,
${data.name}
${location}`;
                    
                    document.getElementById('emailSubject').textContent = 'Subject: Concern Regarding Proposed Burn Facility at 15401 N. Cartwright Rd';
                    document.getElementById('emailContent').textContent = mockEmail;
                    document.getElementById('results').style.display = 'block';
                    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('Failed to generate email. Please try again.');
                }
            } finally {
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        }

        // Copy to clipboard handler
        function copyToClipboard() {
            const subject = document.getElementById('emailSubject').textContent.replace('Subject: ', '');
            const content = document.getElementById('emailContent').textContent;
            const fullText = `${subject}\n\n${content}`;
            
            navigator.clipboard.writeText(fullText).then(() => {
                const button = document.getElementById('copyButton');
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.style.background = '#28a745';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            }).catch(() => {
                alert('Failed to copy to clipboard. Please select and copy manually.');
            });
        }

        // Email client handler
        function openEmailClient() {
            const subject = document.getElementById('emailSubject').textContent.replace('Subject: ', '');
            const content = document.getElementById('emailContent').textContent;
            
            // Commissioners email
            const to = 'commish@adacounty.id.gov';
            const mailto = `mailto:${to}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(content)}`;
            
            window.location.href = mailto;
        }

        // Share tool functionality
        async function shareTool() {
            const shareData = {
                title: 'Help Stop the Non-compliant Shooting Range',
                text: 'I found this tool that makes it easy to email Ada County officials about the shooting range. Check it out:',
                url: window.location.href
            };
            
            if (navigator.share) {
                try {
                    await navigator.share(shareData);
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        // Fallback to copying link
                        copyToolLink();
                    }
                }
            } else {
                // Fallback for desktop - copy link
                copyToolLink();
            }
        }
        
        function copyToolLink() {
            const toolUrl = window.location.href;
            navigator.clipboard.writeText(toolUrl).then(() => {
                const button = document.getElementById('shareToolButton');
                const originalText = button.innerHTML;
                button.innerHTML = '✓ Link Copied!';
                button.style.background = '#28a745';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = '#2c5282';
                }, 2000);
            }).catch(() => {
                // Fallback fallback - show URL
                alert('Share this link: ' + toolUrl);
            });
        }

        // Test mode - pre-fill form if ?test=true
        function checkTestMode() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('test') === 'true') {
                // Pre-fill form with test data
                document.getElementById('name').value = 'Test User';
                document.getElementById('city').value = 'Boise';
                document.getElementById('state').value = 'ID';
                document.getElementById('zipcode').value = '83714';
                
                // Check some boxes
                document.querySelector('input[name="residentType"][value="homeowner"]').checked = true;
                document.querySelector('input[name="residentType"][value="hiker"]').checked = true;
                document.querySelector('input[name="distance"][value="1_to_2"]').checked = true;
                document.querySelector('input[name="concerns"][value="fire_risk"]').checked = true;
                document.querySelector('input[name="concerns"][value="noise_pollution"]').checked = true;
                document.querySelector('input[name="tone"][value="formal"]').checked = true;
                document.querySelector('input[name="lengthStyle"][value="standard"]').checked = true;
                
                document.getElementById('personalImpact').value = 'I hike these trails with my family every weekend.';
                
                // Add visual indicator
                document.querySelector('.header').style.border = '3px solid #ff6b6b';
                const testBadge = document.createElement('div');
                testBadge.style.cssText = 'position: fixed; top: 10px; right: 10px; background: #ff6b6b; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; z-index: 1000;';
                testBadge.textContent = 'TEST MODE';
                document.body.appendChild(testBadge);
            }
        }

        // Initialize
        buildFormFields();
        checkTestMode();
        document.getElementById('emailForm').addEventListener('submit', handleSubmit);
        document.getElementById('copyButton').addEventListener('click', copyToClipboard);
        document.getElementById('emailButton').addEventListener('click', openEmailClient);
        document.getElementById('shareToolButton').addEventListener('click', shareTool);
    </script>
</body>
</html>